<html>
    <head>
    <title>Ninjavan routing</title>
    <style>
    body {
        font-family: Arial;
    }
    
    #map-layer {
        margin: 0px auto;
        max-width: 1000px;
        min-height: 600px;
    }
    .submit-btn {
        background: #FF0000;
        border: black 2px solid;
        border-radius: 10px;
        padding: 5px 20px;
        text-align: center;
        margin: 20px auto;
        display: flex;
        justify-content: center;
        align-items: center;
        cursor: pointer;
    }
    .lbl-way-points {
        font-weight: bold;
        margin-bottom: 15px;
        text-align: center;
    }
    .way-points-option {
        display:inline-block;
        margin-right: 15px;
    }
    table {
        margin: 20px auto;
    }
    </style>
    <script src="jquery-3.2.1.min.js"></script>
    </head>
    <body>
        <h1>Ninjavan driver routing</h1>
        <div class="lbl-way-points">Way Points</div>
        <div>
            
        <!-- <?php
        foreach ($countryResult as $k => $v) {
        ?>
            <div class="way-points-option"><input type="checkbox" name="way_points[]" class="way_points" value="<?php echo $countryResult[$k]["country"]; ?>"> <?php echo $countryResult[$k]["country"]; ?></div>
        <?php
        }
        ?> -->
        <div class="way-points-option">
            <!-- <input type="checkbox" name="way_points[]" class="way_points" value="600312"> A -->
            <!-- <input type="checkbox" name="way_points[]" class="way_points" value="609477"> B -->
            <input type="checkbox" name="way_points[]" class="way_points" value="1.346658117,103.7332758"> A
            <input type="checkbox" name="way_points[]" class="way_points" value="1.347293233,103.7345715"> B
            <input type="checkbox" name="way_points[]" class="way_points" value="1.348205814,103.7338064"> C
            <input type="checkbox" name="way_points[]" class="way_points" value="1.34607862,103.7352659"> D
            <input type="checkbox" name="way_points[]" class="way_points" value="1.34868892,103.7317899"> E
            <input type="checkbox" name="way_points[]" class="way_points" value="1.349737874,103.7318941"> F
            <input type="checkbox" name="way_points[]" class="way_points" value="1.2962761,103.8500902"> SMU
        </div>


        <input type="button" id="go" value="Draw Path" class="submit-btn" />
        </div>
        
        <div id="map-layer"></div>

        <div id="msg"></div>
        <script>
            var map;
            var waypoints;
            function initMap() {
                var mapLayer = document.getElementById("map-layer"); 
                var centerCoordinates = new google.maps.LatLng(1.3521, 103.8198);
                var defaultOptions = { center: centerCoordinates, zoom: 12 }
                map = new google.maps.Map(mapLayer, defaultOptions);

                var directionsService = new google.maps.DirectionsService;
                var directionsDisplay = new google.maps.DirectionsRenderer;
                directionsDisplay.setMap(map);
    
                $("#go").on("click",function() {
                    waypoints = Array();
                    $('.way_points:checked').each(function() {
                    var latLng=$(this).val().split(",");
                    waypoints.push({
                        location: {lat: parseFloat(latLng[0]), lng: parseFloat(latLng[1])},
                        // location: $(this).val(),
                        stopover: true
                        });
                    // console.log($(this).val()); //lat,lon
                    });


                    var locationCount = waypoints.length;
                    // console.log(waypoints)
                    if(locationCount > 0) {
                        var start = waypoints[0].location;
                        var end = waypoints[locationCount-1].location;
                        drawPath(directionsService, directionsDisplay,start,end);
                    }
                });
                
            }
                function drawPath(directionsService, directionsDisplay,start,end) {
                    directionsService.route({
                        origin: start,
                        destination: end,
                        waypoints: waypoints,
                        optimizeWaypoints: true,
                        travelMode: 'DRIVING'
                    }, function(response, status) {
                        if (status === 'OK') {
                            directionsDisplay.setDirections(response);
                            console.log(response.routes[0].legs) // all the legs
                            var arr = response.routes[0].legs

                            // var directionsData = response.routes[0].legs[0]; // Get data about the mapped route
                            // if (!directionsData) {
                            //     window.alert('Directions request failed');
                            //     return;
                            // }
                            // else {
                            //     document.getElementById('msg').innerHTML += " Driving distance is " + directionsData.distance.text + " (" + directionsData.duration.text + ").";
                            // }

                            // do not take 0 and length
                            // console.log(response.routes[0].legs[1].start_address)
                            // console.log(response.routes[0].legs[1].end_address)
                            // console.log(response.routes[0].legs[1].distance.text)
                            // console.log(response.routes[0].legs[1].duration.text)
                            
                            var table = `<table border="1">
                                            <tr>
                                                <th>S/N</th>
                                                <th>Start</th>
                                                <th>End</th>
                                                <th>Distance</th>
                                                <th>Duration</th>
                                            </tr>`
                            var count = 1;

                            for (let i = 1; i < arr.length - 1 ; i++ ) {
                                var directionsData = response.routes[0].legs[i]; // Get data about the mapped route
                                if (!directionsData) {
                                    window.alert('Directions request failed');
                                    return;
                                }
                                else {
                                    // console.log(directionsData.start_address)
                                    // console.log(directionsData.end_address)
                                    // console.log(directionsData.distance.text)
                                    // console.log(directionsData.duration.text)
                                    table += `
                                            <tr>
                                                <td>${count}</td>
                                                <td>${directionsData.start_address}</td>
                                                <td>${directionsData.end_address}</td>
                                                <td>${directionsData.distance.text}</td>
                                                <td>${directionsData.duration.text}</td>
                                            </tr>
                                    `
                                    count++;
                                    // console.log("------- seperate ------")
                                    // document.getElementById('msg').innerHTML += " Driving distance is " + directionsData.distance.text + " (" + directionsData.duration.text + ").";
                                }
                            }
                            table += "</table>"
                            document.getElementById('msg').innerHTML = table;
                        } else {    
                            window.alert('Problem in showing direction due to ' + status);
                        }
                    });
                }
        </script>
        <script async defer
            src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBcpalrE9_ZFn2xFnqhvOZnk1vT_kn_KXk&callback=initMap">
        </script>
    </body>
    </html>